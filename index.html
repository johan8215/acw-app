<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Allston Car Wash App</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="acw-icon.png">
  <meta name="theme-color" content="#0A63D8">
  <style>
    :root{
      --blue:#0A63D8; --deep:#083D8D; --sky:#7CC7FF;
      --glass: rgba(255,255,255,.13); --glass-border: rgba(255,255,255,.28);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color:#fff; min-height:100vh;
      background: linear-gradient(180deg,#0A1F44,#0A63D8 55%,#88D0FF);
      display:flex; align-items:center; justify-content:center; padding:32px 18px;
    }
    .wrap{ width:980px; max-width:100%; display:grid; gap:18px; grid-template-columns:1fr 1fr;}
    @media (max-width:820px){ .wrap{grid-template-columns:1fr;} }
    .mini{ position:fixed; left:16px; top:16px; display:flex; gap:10px; align-items:center;
      background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.25);
      padding:8px 12px; border-radius:12px; backdrop-filter:blur(6px); }
    .logo{ width:42px; height:42px; border-radius:12px; background:#fff url(acw-icon.png) center/90% no-repeat; animation:spin 8s linear infinite;}
    @keyframes spin{from{transform:rotate(0)} to{transform:rotate(360deg)}}
    .brand{font-weight:700; letter-spacing:.3px}
    .card{ background:var(--glass); border:1px solid var(--glass-border); border-radius:18px; padding:20px;
      backdrop-filter: blur(10px) saturate(140%); box-shadow:0 12px 30px rgba(2,22,60,.35); }
    .card h3{ margin:6px 0 12px 0; color:#fff; font-size:1.2rem; }
    .badge{ background:#fff1; border:1px solid #fff3; color:#fff; padding:6px 10px; border-radius:10px; font-size:.85rem;}
    label{ font-size:.9rem; opacity:.9; display:block; margin-bottom:6px;}
    input,select{ width:100%; padding:12px 14px; border-radius:12px; border:1px solid #ffffff33; background:#ffffff18; color:#fff; outline:none;}
    input::placeholder{ color:#e8f3ff; opacity:.75;}
    .btn{ appearance:none; width:100%; padding:12px 16px; border-radius:14px; border:0; cursor:pointer;
      background:linear-gradient(180deg,#2C8CFF,#0A63D8); color:#fff; font-weight:700; letter-spacing:.3px; box-shadow:0 10px 22px rgba(2,30,90,.35);}
    .btn.secondary{ background:#ffffff10; border:1px solid #ffffff33; }
    .muted{ opacity:.8; font-size:.9rem;}
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    .status{ margin-top:8px; min-height:24px; font-size:.9rem;}
    .footer{ text-align:center; color:#e9f4ff; font-size:.9rem; margin-top:16px;}
    .footer a{ color:#e9f4ff }
    .title{ text-align:center; margin-bottom:8px;}
    .title h1{ margin:4px 0 8px 0; font-size:1.8rem;}
    .title .kicker{ opacity:.9; font-size:.95rem;}
    .welcome{ margin-bottom:10px; padding:10px 12px; border-radius:12px; background:#ffffff1c; border:1px solid #ffffff30;}
  </style>
</head>
<body>
  <div class="mini"><div class="logo"></div><div class="brand">ACW · Allston Car Wash</div></div>
  <main class="wrap">
    <section class="card">
      <div class="title">
        <div class="kicker" id="todayStr">–</div>
        <h1 style="margin:0;">Allston Car Wash</h1>
        <div class="kicker">Schedule • Hours • Updates</div>
      </div>
      <div class="welcome" id="roleBanner" hidden></div>
      <div class="row">
        <div>
          <label for="lang">Language / Idioma</label>
          <select id="lang"><option value="en">English</option><option value="es">Español</option></select>
        </div>
        <div><label>&nbsp;</label><span class="badge" id="weekRange">–</span></div>
      </div>
      <div style="height:8px"></div>
      <label for="email">Email (Google)</label>
      <input id="email" type="email" placeholder="you@gmail.com" autocomplete="email">
      <label for="shortname" style="margin-top:8px;">Short name (e.g., J. Giraldo)</label>
      <input id="shortname" type="text" placeholder="J. Giraldo" autocomplete="name">
      <div style="height:10px"></div>
      <button class="btn" id="viewBtn">View my schedule</button>
      <div class="status" id="status"></div>
      <div class="footer">
        <a href="https://allstoncarwash.com" target="_blank" rel="noopener">allstoncarwash.com</a> · (617) 254-3200<br>
        Creado por <strong>Johan A. Giraldo</strong> · v3.0
      </div>
    </section>
    <section class="card">
      <h3 id="panelTitle">Panel (Manager / Supervisor)</h3>
      <div class="muted" id="panelSubtitle">Quick actions sent by WhatsApp</div>
      <div style="height:10px"></div>
      <button class="btn" id="sendToday">Send Today</button>
      <div style="height:8px"></div>
      <button class="btn secondary" id="sendTomorrow">Send Tomorrow</button>
      <div style="height:8px"></div>
      <button class="btn secondary" id="sendUpdates">Send Updates</button>
      <div class="status" id="mstatus"></div>
    </section>
  </main>
  <script>
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyi8Yna3SRi2ag0qMoMgFT_XZB8x2l25-7Wle8dhEp3MbTQCHpOh17gBBDDSRhUP9Xx/exec";
    const ROLES = {
      owners: ["mcdelaney87@gmail.com","mark.delaney89@gmail.com"],
      managers: ["johan8215@gmail.com","tito12079@gmail.com"],
      supervisors: ["wenleobarrera@gmail.com"]
    };
    const DAILY_SNIPPETS = ["💪 Gracias por tu esfuerzo—¡vamos con toda hoy!","⏰ Por favor llega a tiempo y revisa tu horario completo.","🙌 Buen trabajo esta semana; keep it up!","🌟 Actitud positiva = mejor servicio. ¡Gracias!","💧 Cars shine brighter cuando llegamos puntuales.","📲 Revisa cambios en tu schedule antes de empezar.","🚀 Small habits, big results. ¡Tú puedes!","👍 Gracias por tu compromiso con ACW.","🧼 Shine day! Vamos equipo 💙","🕓 Be on time. Gracias por tu energía."];
    const T = {
      en:{view:"View my schedule",todayPanel:"Panel (Manager / Supervisor)",todaySub:"Quick actions sent by WhatsApp",sendToday:"Send Today",sendTomorrow:"Send Tomorrow",sendUpdates:"Send Updates",errLoad:"Couldn’t load schedule. Check your email/name.",owner:"Owner",manager:"Manager",supervisor:"Supervisor"},
      es:{view:"Ver mi horario",todayPanel:"Panel (Manager / Supervisor)",todaySub:"Acciones rápidas enviadas por WhatsApp",sendToday:"Enviar HOY",sendTomorrow:"Enviar MAÑANA",sendUpdates:"Enviar ACTUALIZACIONES",errLoad:"No se pudo cargar el horario. Revisa tu email/nombre.",owner:"Propietario",manager:"Manager",supervisor:"Supervisor"}
    };
    const $ = s=>document.querySelector(s);
    const langSel=$("#lang"), status=$("#status"), mstatus=$("#mstatus");
    const browserLang=(navigator.language||"en").toLowerCase().startsWith("es")?"es":"en";
    langSel.value=localStorage.getItem("acw_lang")||browserLang;
    function applyLocale(){ const L=T[langSel.value]; $("#viewBtn").textContent=L.view; $("#panelTitle").textContent=L.todayPanel; $("#panelSubtitle").textContent=L.todaySub; $("#sendToday").textContent=L.sendToday; $("#sendTomorrow").textContent=L.sendTomorrow; $("#sendUpdates").textContent=L.sendUpdates; }
    applyLocale(); langSel.addEventListener("change",()=>{ localStorage.setItem("acw_lang",langSel.value); applyLocale(); });
    const now=new Date(); const wd=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]; const mo=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    $("#todayStr").textContent=`${wd[now.getDay()]} ${mo[now.getMonth()]} ${now.getDate()}`;
    function formatWeekRange(d){ const day=d.getDay(); const diffToMon=(day+6)%7; const mon=new Date(d); mon.setDate(d.getDate()-diffToMon); const sun=new Date(mon); sun.setDate(mon.getDate()+6); const fmt=x=>`${x.getMonth()+1}/${x.getDate()}/${String(x.getFullYear()).slice(-2)}`; return `${fmt(mon)} – ${fmt(sun)}`;}
    $("#weekRange").textContent=formatWeekRange(now);
    function roleOf(email){ const e=(email||"").toLowerCase().trim(); if(ROLES.owners.includes(e)) return "owner"; if(ROLES.managers.includes(e)) return "manager"; if(ROLES.supervisors.includes(e)) return "supervisor"; return "employee"; }
    function showBanner(email){ const role=roleOf(email); const box=$("#roleBanner"); const L=T[langSel.value]; if(role==="employee"){ box.hidden=true; return; } let title=role==="owner"?L.owner:role==="manager"?L.manager:L.supervisor; const msg={owner:"Bienvenido, Owner · acceso total al panel.",manager:"Bienvenido, Manager · acceso al envío de horarios.",supervisor:"Bienvenido, Supervisor · acceso a acciones rápidas (solo lectura de horarios)."}; box.hidden=false; box.innerHTML=`<strong>${title}</strong> — ${msg[role]}`; }
    async function callAction(action){ const email=$("#email").value.trim(); const short=$("#shortname").value.trim(); localStorage.setItem("acw_email",email); localStorage.setItem("acw_short",short); showBanner(email); const L=T[langSel.value]; const url=APPS_SCRIPT_URL+`?action=${encodeURIComponent(action)}&email=${encodeURIComponent(email)}&short=${encodeURIComponent(short)}`; const target=action==='view'?status:mstatus; target.textContent="…"; try{ const r=await fetch(url); const txt=await r.text(); target.textContent=txt||"OK"; }catch(err){ target.textContent=L.errLoad; } }
    $("#viewBtn").addEventListener("click",()=>callAction('view'));
    $("#sendToday").addEventListener("click",()=>callAction('sendToday'));
    $("#sendTomorrow").addEventListener("click",()=>callAction('sendTomorrow'));
    $("#sendUpdates").addEventListener("click",()=>callAction('sendUpdates'));
    $("#email").value=localStorage.getItem("acw_email")||"";
    $("#shortname").value=localStorage.getItem("acw_short")||"";
    showBanner($("#email").value);
    if('serviceWorker' in navigator){ window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js')); }
  </script>
</body>
</html>
