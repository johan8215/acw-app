<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Allston Car Wash</title>
  <link rel="stylesheet" href="style.css">
  <script src="config.js"></script>
  <script src="app.js"></script>
</head>
<body>
  <div class="container">
  <h1>ALLSTON CAR WASH</h1>

  <!-- üîë LOGIN -->
  <div id="login">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="loginUser()">Sign In</button>
  </div>

  <!-- ‚úÖ WELCOME VIEW -->
  <div id="welcome" style="display:none;">
    <h2>Welcome, <span id="userName"></span></h2>
    <p>Role: <span id="userRole"></span></p>

    <!-- ‚öôÔ∏è BOT√ìN DE CONFIGURACI√ìN -->
    <button id="gearButton" class="gear-btn" onclick="openSettings()">‚öôÔ∏è</button>

    <!-- üß© PANEL FLOTANTE -->
    <div id="settingsModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeSettings()">&times;</span>
        <h3>Settings</h3>
        <hr>
        <button class="mini-btn" onclick="togglePasswordPanel()">Change Password</button>
        <button class="mini-btn" onclick="logoutUser()">Logout</button>

        <!-- üîí PANEL DE CAMBIO DE PASSWORD -->
        <div id="passwordPanel" style="display:none; margin-top:10px;">
          <input type="password" id="newPassword" placeholder="New password">
          <input type="password" id="confirmPassword" placeholder="Confirm password">
          <button class="mini-btn" onclick="changeUserPassword()">Save</button>
          <p id="settingsMsg"></p>
        </div>
      </div>
    </div>

    <div id="schedule"></div>
  </div>
</div>
  <script>
    /* ===========================================================
       üóìÔ∏è Mostrar semana activa al cargar login
       =========================================================== */
    window.addEventListener("load", async () => {
      const label = document.getElementById("activeWeek");
      try {
        const res = await fetch(`${CONFIG.BASE_URL}?action=getActiveWeek`);
        const data = await res.json();
        if (data.week) label.textContent = `üìÖ Active Week: ${data.week}`;
        else label.textContent = "No active week found";
      } catch (err) {
        label.textContent = "Unable to load week";
      }
    });
  </script>
</body>
</html>
