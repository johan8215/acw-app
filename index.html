<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Allston Car Wash • ACW</title>
  <meta name="theme-color" content="#0b3a77" />
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="acw-icon.png">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    :root{
      --blue-dark:#0b3a77; --glass-bg: rgba(255,255,255,.08); --glass-stroke: rgba(255,255,255,.18);
      --txt:#eef6ff;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:var(--txt);
      background: radial-gradient(1200px 600px at 15% -10%, #1b5ed6 0%, transparent 60%),
                  radial-gradient(1200px 600px at 120% 120%, #1286ff22 0%, transparent 60%),
                  linear-gradient(180deg, #05234a 0%, #0b3a77 55%, #0e4c9a 100%);
      display:flex;flex-direction:column}
    header{display:flex;align-items:center;gap:.75rem;padding:14px 18px}
    .logo{width:40px;height:40px;border-radius:10px;background:#fff;color:#0b64cf;font-weight:800;
      display:grid;place-items:center;box-shadow:0 6px 20px rgba(0,0,0,.25);animation:spinIn 1.6s ease both}
    .logo.spin{animation:spin 2s linear infinite}
    @keyframes spinIn{from{transform:scale(.6) rotate(-15deg);opacity:0}to{transform:scale(1) rotate(0);opacity:1}}
    @keyframes spin{to{transform:rotate(360deg)}}
    .brand{font-weight:700;letter-spacing:.2px}.roleBadge{margin-left:auto;padding:6px 10px;border-radius:999px;border:1px solid var(--glass-stroke);background:var(--glass-bg);font-size:.85rem}
    main{flex:1;display:grid;place-items:center;padding:28px 18px 36px}
    .grid{display:grid;gap:22px;width:100%;max-width:1100px;grid-template-columns:1fr 1fr}
    .card{background:var(--glass-bg);border:1px solid var(--glass-stroke);border-radius:18px;box-shadow:0 20px 60px rgba(0,0,0,.28),inset 0 1px 0 rgba(255,255,255,.12);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);padding:18px}
    .titleRow{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:10px}
    h1{font-size:1.25rem;margin:0;font-weight:700}.sub{opacity:.85;font-size:.9rem}
    .row{display:flex;gap:10px;align-items:center;margin:10px 0}
    .input,select,button{width:100%;border-radius:12px;padding:12px 14px;border:1px solid rgba(255,255,255,.18);background:rgba(8,22,44,.35);color:var(--txt);outline:none}
    button.primary{background:linear-gradient(180deg,#2b78ff,#1763e6);border:1px solid #5290ff;font-weight:700;cursor:pointer;box-shadow:0 8px 24px rgba(17,87,196,.45)}
    button.ghost{background:transparent;border-color:var(--glass-stroke)} button:disabled{opacity:.6;cursor:not-allowed}
    .status{min-height:1.25rem;font-size:.9rem;opacity:.85;margin-top:6px}
    .tbl{width:100%;border-collapse:collapse;margin-top:10px}
    .tbl th,.tbl td{padding:10px 12px;border-bottom:1px dashed rgba(255,255,255,.12);text-align:left}
    .tbl th{opacity:.8;font-weight:600}.hours{font-weight:700}
    footer{text-align:center;font-size:.9rem;opacity:.85;padding:18px}
    .acwLink{color:#a9d7ff;text-decoration:none}
    @media (max-width:900px){.grid{grid-template-columns:1fr;max-width:680px}.roleBadge{display:none}}
  </style>
</head>
<body>
  <header>
    <div class="logo" id="acwLogo">ACW</div>
    <div class="brand">
      <div style="font-weight:800">Allston Car Wash</div>
      <div style="font-size:.85rem;opacity:.8" id="todayTxt"></div>
    </div>
    <div class="roleBadge" id="roleBadge" hidden>Employee</div>
  </header>

  <main>
    <div class="grid">
      <section class="card" id="cardSelf">
        <div class="titleRow">
          <h1 id="cardTitle">Allston Car Wash</h1>
          <div class="sub"><span id="rangeLabel">—</span></div>
        </div>
        <div class="row">
          <select id="lang"><option value="en">English</option><option value="es">Español</option></select>
          <button class="ghost" id="btnLangAuto" style="width:auto;padding:12px 14px;white-space:nowrap">Auto</button>
        </div>
        <div id="googleBtnWrap" class="row"></div>
        <div class="row"><input id="email" class="input" type="email" placeholder="you@gmail.com (Google)" /></div>
        <div class="row"><input id="short" class="input" type="text" placeholder="Short name (e.g., J. Giraldo)" /></div>
        <div class="row"><button class="primary" id="btnView">View my schedule</button></div>
        <div id="status" class="status"></div>
        <table class="tbl" id="tbl" hidden>
          <thead><tr><th>Day</th><th>Shift</th><th class="hours">Hours</th></tr></thead>
          <tbody id="tbody"></tbody>
          <tfoot><tr><th>Total</th><th></th><th class="hours" id="totH">0</th></tr></tfoot>
        </table>
      </section>

      <section class="card" id="cardMgr" hidden>
        <div class="titleRow"><h1>Panel (Manager / Supervisor)</h1></div>
        <div class="row"><button id="btnToday" class="primary" disabled>Send TODAY</button></div>
        <div class="row"><button id="btnTomorrow" class="ghost" disabled>Send TOMORROW</button></div>
        <div class="row"><button id="btnUpdates" class="ghost" disabled>Send UPDATES</button></div>
        <div id="statusMgr" class="status"></div>
      </section>
    </div>
  </main>

  <footer>
    <a class="acwLink" href="https://allstoncarwash.com" target="_blank" rel="noopener">allstoncarwash.com</a>
    · (617) 254-3200 · v3.2 PWA
  </footer>

<script>
const APPS_SCRIPT_ENDPOINT = "https://script.google.com/macros/s/AKfycbwP8wLef4nALo4e49bzUzgKqTcISpfWsm4TTxMPEzisDHygnebY8dGb_8XmQ7kWB1tB/exec";
const GOOGLE_CLIENT_ID = "YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com";
const ROLES = { owners:["mark.delaney89@gmail.com","mcdelaney87@gmail.com"], managers:["johan8215@gmail.com","tito12079@gmail.com","acw.jag@gmail.com"], supervisors:["wendybarrera@example.com"] };
const $ = s=>document.querySelector(s);
const todayTxt = (()=>{const d=new Date();return d.toLocaleDateString(navigator.language||'en-US',{weekday:'short',month:'short',day:'numeric'})})(); $("#todayTxt").textContent=todayTxt;
function autoSetLang(){ const lang=(navigator.language||'en').startsWith('es')?'es':'en'; $("#lang").value=lang; }
function t(key){ const lang=$("#lang").value; const dict={en:{day:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]}, es:{day:["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"]}}; return dict[lang][key]; }
window.onload=()=>{
  autoSetLang(); $("#btnLangAuto").addEventListener('click', autoSetLang);
  const logo=$("#acwLogo"); logo.classList.add("spin"); setTimeout(()=>logo.classList.remove("spin"),2000);
  if (GOOGLE_CLIENT_ID && window.google && google.accounts && google.accounts.id){
    google.accounts.id.initialize({client_id:GOOGLE_CLIENT_ID, callback:(resp)=>{try{const payload=JSON.parse(atob(resp.credential.split('.')[1])); $("#email").value=payload.email||""; localStorage.setItem("acw-email",payload.email||""); decideRole();}catch(e){}}});
    google.accounts.id.renderButton(document.getElementById("googleBtnWrap"),{theme:"outline",size:"large",text:"signin_with",shape:"pill",width:320});
  }
  const em=localStorage.getItem("acw-email"); if(em) $("#email").value=em;
  const sh=localStorage.getItem("acw-short"); if(sh) $("#short").value=sh;
  $("#btnView").addEventListener("click", viewSchedule);
  $("#btnToday").addEventListener("click", ()=>quickAction("sendToday"));
  $("#btnTomorrow").addEventListener("click", ()=>quickAction("sendTomorrow"));
  $("#btnUpdates").addEventListener("click", ()=>quickAction("sendUpdates"));
  decideRole(); setWeekRangeLabel();
};
function setWeekRangeLabel(){ const now=new Date(); const day=now.getDay(); const diff=(day===0?-6:1-day); const monday=new Date(now); monday.setDate(now.getDate()+diff); const sunday=new Date(monday); sunday.setDate(monday.getDate()+6); const opts={month:'2-digit',day:'2-digit'}; $("#rangeLabel").textContent=`${monday.toLocaleDateString(undefined,opts)} – ${sunday.toLocaleDateString(undefined,{...opts,year:'2-digit'})}`; }
function decideRole(){ const email=($("#email").value||"").trim().toLowerCase(); const role=computeRole(email); const badge=$("#roleBadge"); if(role){badge.textContent=role[0].toUpperCase()+role.slice(1); badge.hidden=false;} else {badge.hidden=true;} const showMgr=["manager","owner","supervisor"].includes(role); $("#cardMgr").hidden=!showMgr; const ready=showMgr&&!!email; ["#btnToday","#btnTomorrow","#btnUpdates"].forEach(id=>$(id).disabled=!ready); }
function computeRole(email){ if(!email) return ""; if(ROLES.owners.includes(email)) return "owner"; if(ROLES.managers.includes(email)) return "manager"; if(ROLES.supervisors.includes(email)) return "supervisor"; return "employee"; }
async function viewSchedule(){
  const email=($("#email").value||"").trim().toLowerCase(); const short=($("#short").value||"").trim();
  localStorage.setItem("acw-email",email); localStorage.setItem("acw-short",short); $("#status").textContent=""; $("#btnView").disabled=true;
  try{
    const url=`${APPS_SCRIPT_ENDPOINT}?action=getSchedule&email=${encodeURIComponent(email)}&short=${encodeURIComponent(short)}`;
    const r=await fetch(url,{cache:'no-store'}); const data=await r.json();
    if(data.error){ $("#status").textContent=(data.error==="Employee not found")?($("#lang").value==="es"?"No se encontró el empleado. Prueba el short name (ej. J. Giraldo).":"Employee not found. Try short name like J. Giraldo."):data.error; $("#tbl").hidden=true; return; }
    const tbody=$("#tbody"); tbody.innerHTML=""; const days=data.days||[]; const labels=t('day'); days.forEach((d,i)=>{ const tr=document.createElement("tr"); const td1=document.createElement("td"); td1.textContent=labels[i%7]; const td2=document.createElement("td"); td2.textContent=d.shift||"-"; const td3=document.createElement("td"); td3.className="hours"; td3.textContent=d.hours||0; tr.append(td1,td2,td3); tbody.appendChild(tr); }); $("#totH").textContent=(data.total||0); $("#tbl").hidden=false; $("#status").textContent=""; decideRole();
  }catch(err){ $("#status").textContent="Network / endpoint error."; } finally{ $("#btnView").disabled=false; }
}
async function quickAction(kind){ const status=$("#statusMgr"); status.textContent="Sending…"; try{ const url=`${APPS_SCRIPT_ENDPOINT}?action=${encodeURIComponent(kind)}`; const r=await fetch(url,{cache:'no-store'}); const tx=await r.text(); status.textContent=tx.includes("ok")?"✔ Sent":tx.slice(0,120);}catch(e){ status.textContent="Error sending."; } }
</script>
</body>
</html>
